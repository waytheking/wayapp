<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="images/bklogo1.png">
  <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
  <link href="css/bingkas.css" rel="stylesheet" type="text/css" media="all" />
  <title>BINGKAS</title>
  <style>
.all-product-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 15px;
    padding: 20px; /* Padding around product grid */
    background-color: white; /* Background color for the container */
    border-radius: 20px; /* Rounded corners */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Light shadow */
    margin-top: 20px; /* Space between header and product grid */
    position: relative; /* Make it a positioned element */
    min-height: 400px; /* Ensure a minimum height for the grid */
}

.no-results {
    position: absolute; /* Position it absolutely within the container */
    top: 50%; /* Center vertically */
    left: 50%; /* Center horizontally */
    transform: translate(-50%, -50%); /* Shift back to center */
    text-align: center; /* Center text */
    width: 100%; /* Take the full width of the container */
    max-width: 400px; /* Set a maximum width for the no-results container */
}

.no-results-image {
    max-width: 150%; /* Allow image to be responsive */
    max-height: 250px; /* Set a maximum height for the image */
    height: auto; /* Maintain aspect ratio */
}

.no-results-message {
    text-align: center; /* Center text horizontally */
    margin: 20px 0; /* Add some vertical spacing */
    font-size: 20px; /* Adjust font size as needed */
    color: #666; /* Change text color to a lighter shade */
}

.no-results-message strong {
    font-weight: bold; /* Bold the searched word */
}


  </style>
</head>

<body>

      <!-- Navbar Section -->
  <div class="navbar">
    <div class="logo">
      <a href="bingkas.html">
          <img src="images/bk.png" alt="Logo">
      </a>
  </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" class="search-left-icon">
        <path d="M10 2a8 8 0 016.32 12.906l4.387 4.387-1.415 1.415-4.387-4.387A8 8 0 1110 2zm0 2a6 6 0 100 12 6 6 0 000-12z" />
        </svg>
        <input type="text" id="search-input" placeholder="What are you looking for?">
    </div>
  

    <!-- Icons -->
    <div class="icons">
      <div class="location-icon">
        <!-- Location Icon with "Select Store" Text -->
        <span id="selectStore">Select Store</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" id="locationIcon">
          <path d="M12 2a7 7 0 017 7c0 4.243-5.02 10.257-6.36 11.74a.995.995 0 01-1.28 0C10.02 19.257 5 13.243 5 9a7 7 0 017-7zm0 2a5 5 0 00-5 5c0 2.692 2.94 6.942 5 9.292C14.06 15.942 17 11.692 17 9a5 5 0 00-5-5zm0 3a2 2 0 110 4 2 2 0 010-4z"/>
        </svg>
      </div>
    

      <!-- Shopping Bag Icon with Product Count Badge -->
        <a href="cart.html" class="cart-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
            <path d="M12 2a4 4 0 014 4h2.5a2.5 2.5 0 012.495 2.336L21 8.5v11a2.5 2.5 0 01-2.336 2.495L18.5 22h-13a2.5 2.5 0 01-2.495-2.336L3 19.5v-11A2.5 2.5 0 015.336 6.005L5.5 6H8a4 4 0 014-4zm7 6H5.5a.5.5 0 00-.492.41L5 8.5v11a.5.5 0 00.41.492l.09.008h13a.5.5 0 00.492-.41L19 19.5V8z"/>
            </svg>
            <!-- Badge for showing the product count -->
            <span class="cart-count">0</span>
        </a>
  

      <!-- User Icon -->
      <div class="user-icon">
        <span id="user-balance" class="balance-amount">RM 0</span>
        <a href="account.html">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
            <path d="M12 2a7 7 0 11-.001 14.001A7 7 0 0112 2zm0 2a5 5 0 100 10 5 5 0 000-10zM4.75 16h14.5c.414 0 .75.336.75.75v1.75c0 2.071-3.048 3.5-8 3.5s-8-1.429-8-3.5v-1.75c0-.414.336-.75.75-.75z" />
          </svg>
        </a>
        </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="locationModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2>Welcome!</h2>
      <p>Please set your pickup area</p>
      <input type="text" id="postcodeInput" placeholder="Key in your Postcode">
      <button id="searchButton">Search</button>
      <div id="resultsContainer"></div> <!-- Container for displaying results -->
    </div>
  </div>

  <div class="allproduct-container">
    <div class="header">
        <h1 class="heading-tittle">
            Results for "<span id="searched-word"></span>"
            <span class="cancel-filter" onclick="resetFilter()" style="display: none;">&times;</span>
        </h1>
        <div class="dropdown">
          <p id="results-count" class="results-count"></p> <!-- Added results count here -->
        </div>
    </div>
  
    <div class="all-product-grid" id="allproduct-container">
        <!-- Product Cards will be dynamically inserted here -->
    </div>
  
    <div class="pagination" id="pagination-container">
        <!-- Pagination buttons will be dynamically inserted here -->
    </div>
  </div>


<script src="js/script.js"></script> 
<script src="js/bingkas.js"></script>

<script>
  // Function to get query parameters from the URL
  function getQueryParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
  }

  // Get the search query from the URL
  const query = getQueryParameter('query');
  const searchedWord = document.getElementById('searched-word'); // Correctly select the element to display searched word
  const productGrid = document.getElementById('allproduct-container'); // Use the correct ID for the product grid

  // Set the searched word in the title
  if (query) {
      searchedWord.textContent = query; // Only set if there's a query
  }

  function displayProducts(products, query) {
    productGrid.innerHTML = ''; // Clear previous results

    if (products.length > 0) {
        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card'; // Add class for styling
            card.innerHTML = `
                <img src="${product.image}" alt="${product.name}" class="product-image">
                <div class="product-info">
                    <h3>${product.name}</h3>
                    <p>${product.quantity}</p>
                    <div class="price-section">
                        <span class="current-price">RM ${product.price}</span>
                    </div>
                </div>
                <div class="quantity-add-section">
                    <input type="number" value="1" min="1" class="quantity-selector">
                    <button class="add-button" onclick="addToCart('${product._id}', '${product.name}', ${product.price}, '${product.image}')">ADD</button>
                </div>
            `;
            productGrid.appendChild(card);
        });
    } else {
        // Display no results found message with an image
        const noResultsMessage = document.createElement('div');
        noResultsMessage.className = 'no-results'; // Add class for centering
        noResultsMessage.innerHTML = `
            <img src="images/nope.png" alt="No Results" class="no-results-image"> <!-- Replace with your image path -->
            <p>No results for "<strong>${query}</strong>"</p>
            <p>Try checking the spelling or search with more generic terms.</p>
        `;
        productGrid.appendChild(noResultsMessage);
    }
  }

// Fetch products and display them based on the search query
async function fetchProducts() {
    try {
        const response = await fetch('/api/products');
        const allProducts = await response.json(); // Store fetched products locally
        
        const filteredProducts = allProducts.filter(product =>
            product.name.toLowerCase().includes(query.toLowerCase()) ||
            product.category.toLowerCase().includes(query.toLowerCase()) // Check category as well
        );
        
        displayProducts(filteredProducts, query); // Display filtered products
        displayTotalItems(filteredProducts.length); // Update total items displayed
    } catch (error) {
        console.error('Error fetching products:', error);
    }
}

// Call the fetchProducts function to display results
fetchProducts();


function displayTotalItems(count) {
    const resultsCount = document.getElementById('results-count');
    resultsCount.textContent = `${count} results found`; // Update the results count text
}

document.addEventListener('DOMContentLoaded', function () {
  fetch('/api/user')
      .then(response => response.json())
      .then(user => {
          if (user.balance !== undefined) {
              // Update the balance in the navbar
              document.getElementById('user-balance').textContent = `RM ${user.balance}`;
          }
      })
      .catch(error => {
          console.error('Error fetching user data:', error);
      });
});
</script>


</body>
</html>
